# Signal-Quality-Assessment

This repository contains Python scripts to assess the quality of time-series signals. The main steps include:
1. **Reading** raw data (TXT or CSV) from text files (in `data/raw/`).
2. **Preprocessing** them into consistent CSV format (saved in `data/processed/`).
3. **Segmenting** signals into windows.
4. **Transforming** them to the frequency domain (FFT).
5. **Computing** quality metrics (Spectral Entropy, etc.).
6. **Visualizing** the mean spectrum with uncertainty (standard deviation).
7. **Saving** metrics into timestamped `.yml` files.

> **Multi-Channel Note**: If your file has multiple numeric columns (e.g., `Ch_1`, `Ch_2`), each channel is processed independently, generating separate results per channel.

## Table of Contents
- [Directory Structure](#directory-structure)
- [Installation](#installation)
- [Usage](#usage)
- [Example Commands](#example-commands)
- [Details](#details)

## Directory Structure
```
.
├── .gitignore
├── data/
│   ├── raw/
│   │   ├── <some_raw_files>
│   └── processed/
│       ├── <some_processed_files>
├── environment.yml
├── pyproject.toml
├── res/
│   ├── result.yml
│   └── segment_with_uncertainty.png
├── setup.sh
├── src/
│   ├── __init__.py
│   ├── data_preprocessing.py
│   ├── quality_assessment.py
│   ├── utils.py
│   └── vis.py
├── main.py
└── README.md
```
- **data/raw/**: Contains raw `.txt` or `.csv` files.
- **data/processed/**: Holds preprocessed `.csv` files (and optional metadata) generated by the scripts.
- **res/**: Output folder for results (plots and metrics in `.yml` format).
- **src/**: All source code modules.
- **main.py**: Command-line interface script for running signal quality assessment.
- **environment.yml** / **pyproject.toml**: Dependencies configuration.
- **setup.sh**: Setup script.

## Installation

### 1. Clone the Repository
```bash
git clone https://github.com/xndrleib/Signal-Quality-Assessment.git
cd Signal-Quality-Assessment
```

### 2. Set Up the Conda Environment
```bash
bash setup.sh
conda activate py311_sqa
```

### 3. Install the Project in Editable Mode
Install the package using the `pyproject.toml` setup:
```bash
pip install -e .
```

## Usage

### Command-Line Interface
Run the CLI script `main.py` to process either a single file or an entire folder of signals:

```bash
python main.py --input <path_to_file_or_folder> [OPTIONS]
```

**Options**:
- `--res_dir`: Output directory for results (`default: "res"`).
- `--window_length`: Number of samples in each segment (`default: 10000`).
- `--step`: Step size for windowing (`default: 20`).
- `--f_sampling`: Sampling frequency (`default: 10000.0`).
- `--db`: Flag to convert FFT results to dB scale (`default: True`).
- `--cutoff_freq`: Frequency cutoff for filtering (`default: 250.0`).

**How Preprocessing Works**  
- If you specify a `.txt` file in `data/raw/`, the script automatically converts it into a standardized `.csv` in `data/processed/`, extracting metadata if present.  
- If you specify a `.csv` file in `data/raw/`, the script similarly preprocesses it into `data/processed/`, ensuring a consistent format.  
- Then, the main analysis is performed on the files in `data/processed/`.

**Multi-Channel Handling**:  
1. Segment each channel independently.  
2. Compute FFT and quality metrics.  
3. Save per-channel plots (`.png`) and metrics (`.yml`).

## Example Commands

1. **Process a single file**:
   ```bash
   python main.py \
       --input data/raw/data-sample_motor-operating-at-100%-load.txt \
       --res_dir res \
       --window_length 10000 \
       --step 20 \
       --f_sampling 10000 \
       --db True \
       --cutoff_freq 250
   ```
2. **Process all files in the `raw` folder**:
   ```bash
   python main.py --input data/raw/
   ```

After completion, the script will generate:
- **Plots of Average Spectrum with Uncertainty** in `res/`.  
  For multi-channel data, filenames include both file stem and channel name:  
  `spectrum_with_uncertainty_<file_stem>_Ch_1_<timestamp>.png`  
- **Result metrics** in `.yml` files (one per channel):  
  `metrics_<file_stem>_Ch_1_<timestamp>.yml`

## Details

- **Signal Reading**: Implemented in `src/utils.py`. Automatically preprocesses `.txt` or `.csv` files into a uniform, channel-based format in `data/processed/`.
- **Segmentation & FFT**: Implemented in `src/data_preprocessing.py`.
- **Quality Metrics**: Spectral Entropy, dominant frequency ratio, etc. in `src/quality_assessment.py`.
- **Visualization**: Plot functions in `src/vis.py`.
